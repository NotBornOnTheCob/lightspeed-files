!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){(function(process){(function(){exports.formatArgs=function(args){if(args[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+args[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;args.splice(1,0,c,"color: inherit");let index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,match=>{"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c)},exports.save=function(namespaces){try{namespaces?exports.storage.setItem("debug",namespaces):exports.storage.removeItem("debug")}catch(error){}},exports.load=function(){let r;try{r=exports.storage.getItem("debug")}catch(error){}!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG);return r},exports.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},exports.storage=function(){try{return localStorage}catch(error){}}(),exports.destroy=(()=>{let warned=!1;return()=>{warned||(warned=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.log=console.debug||console.log||(()=>{}),module.exports=require("./common")(exports);const{formatters}=module.exports;formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return"[UnexpectedJSONParseError]: "+error.message}}}).call(this)}).call(this,require("_process"))},{"./common":2,_process:4}],2:[function(require,module,exports){module.exports=function(env){function createDebug(namespace){let prevTime,namespacesCache,enabledCache,enableOverride=null;function debug(...args){if(!debug.enabled)return;const self=debug,curr=Number(new Date),ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,args[0]=createDebug.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(match,format)=>{if("%%"===match)return"%";index++;const formatter=createDebug.formatters[format];if("function"==typeof formatter){const val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),createDebug.formatArgs.call(self,args);(self.log||createDebug.log).apply(self,args)}return debug.namespace=namespace,debug.useColors=createDebug.useColors(),debug.color=createDebug.selectColor(namespace),debug.extend=extend,debug.destroy=createDebug.destroy,Object.defineProperty(debug,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==enableOverride?enableOverride:(namespacesCache!==createDebug.namespaces&&(namespacesCache=createDebug.namespaces,enabledCache=createDebug.enabled(namespace)),enabledCache),set:v=>{enableOverride=v}}),"function"==typeof createDebug.init&&createDebug.init(debug),debug}function extend(namespace,delimiter){const newDebug=createDebug(this.namespace+(void 0===delimiter?":":delimiter)+namespace);return newDebug.log=this.log,newDebug}function toNamespace(regexp){return regexp.toString().substring(2,regexp.toString().length-2).replace(/\.\*\?$/,"*")}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function(val){if(val instanceof Error)return val.stack||val.message;return val},createDebug.disable=function(){const namespaces=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(namespace=>"-"+namespace)].join(",");return createDebug.enable(""),namespaces},createDebug.enable=function(namespaces){let i;createDebug.save(namespaces),createDebug.namespaces=namespaces,createDebug.names=[],createDebug.skips=[];const split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length;for(i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+namespaces.slice(1)+"$")):createDebug.names.push(new RegExp("^"+namespaces+"$")))},createDebug.enabled=function(name){if("*"===name[name.length-1])return!0;let i,len;for(i=0,len=createDebug.skips.length;i<len;i++)if(createDebug.skips[i].test(name))return!1;for(i=0,len=createDebug.names.length;i<len;i++)if(createDebug.names[i].test(name))return!0;return!1},createDebug.humanize=require("ms"),createDebug.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(env).forEach(key=>{createDebug[key]=env[key]}),createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=function(namespace){let hash=0;for(let i=0;i<namespace.length;i++)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return createDebug.colors[Math.abs(hash)%createDebug.colors.length]},createDebug.enable(createDebug.load()),createDebug}},{ms:3}],3:[function(require,module,exports){var s=1e3,m=6e4,h=60*m,d=24*h;function plural(ms,msAbs,n,name){var isPlural=msAbs>=1.5*n;return Math.round(ms/n)+" "+name+(isPlural?"s":"")}module.exports=function(val,options){options=options||{};var type=typeof val;if("string"===type&&val.length>0)return function(str){if((str=String(str)).length>100)return;var match=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(val);if("number"===type&&isFinite(val))return options.long?function(ms){var msAbs=Math.abs(ms);if(msAbs>=d)return plural(ms,msAbs,d,"day");if(msAbs>=h)return plural(ms,msAbs,h,"hour");if(msAbs>=m)return plural(ms,msAbs,m,"minute");if(msAbs>=s)return plural(ms,msAbs,s,"second");return ms+" ms"}(val):function(ms){var msAbs=Math.abs(ms);if(msAbs>=d)return Math.round(ms/d)+"d";if(msAbs>=h)return Math.round(ms/h)+"h";if(msAbs>=m)return Math.round(ms/m)+"m";if(msAbs>=s)return Math.round(ms/s)+"s";return ms+"ms"}(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],4:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],5:[function(require,module,exports){const d=require("debug")("filter"),Remote=require("./remote");function allowedLists(url){const allowed=Remote.Policy().allowed;return!!(allowed.protocols.includes(url.protocol)||allowed.urls.includes(url.href.replace(url.search,""))||allowed.hosts.includes(url.hostname.split(":")[0]))}function allowedInternal(h){return!h||!(!h.match(/^(\d{1,3}\.){3}(\d{1,3})$/)||!(h.match(/^127\./)||h.match(/^10\./)||h.match(/^172\.((1[6-9])|(2[0-9])|(3(0|1)))\./)||h.match(/^192\.168\./)||h.match(/^169\.254\./)))}function IsAllowed(details){try{const url=new URL(details.url);if(!Remote.FilterOpen()||!navigator.onLine||function(details){return!(!details.initiator||!(details.initiator.match(chrome.runtime.id)||details.url.match(/docs\.google\.com/)&&details.initiator.match(/docs\.google\.com/)||details.url.match(/youtube\.com/)&&details.initiator.match(/youtube\.com/)))}(details)||allowedInternal(url.hostname)||allowedLists(url)||Remote.Overridable(details)||Remote.IsYoutube(url.hostname)&&["stylesheet","script","xmlhttprequest"].includes(details.type)||"xmlhttprequest"===details.type&&url.hostname.match(/^(([^\.])+\.)?googlevideo\.com$/))return!0}catch(err){d("[IsAllowed] error ->",err)}return!1}let redirectCount={};setInterval((function(){redirectCount={}}),3e5);let lastTabUrl={};module.exports.BeforeRequest=function(details){if(!IsAllowed(details))if("GET"===details.method)Remote.Score(details);else{const url=new URL(details.url),matchedSite=function(hostname){const read_only=Remote.Policy().content_filter.read_only;let matchedSite;return matchFound=Remote.Policy().matchers.social.some(matcher=>{const r=new RegExp(matcher.hostname);hostname.match(r)&&read_only.includes(matcher.catId)&&(matchedSite=matcher)}),matchedSite}(url.hostname);if(matchedSite){if(!matchedSite.ignorePaths.some(matcher=>{const r=new RegExp(matcher);return url.pathname.match(r)}))return d(`[preScan] canceling ${matchedSite.site} request`),{cancel:!0}}}return{}},module.exports.BeforeSendHeaders=function(details){if(IsAllowed(details))return{};const url=new URL(details.url),policy=Remote.Policy();let header;return-1!==policy.matchers.yt_restricted.indexOf(url.hostname.toLowerCase())&&"string"==typeof policy.youtube.restricted_mode&&(header={name:"YouTube-Restrict",value:policy.youtube.restricted_mode},d("[YouTube] Restricted mode enabled, adding to the headers: ",header),details.requestHeaders.push(header)),policy.content_filter.google_filter_domains&&details.url.match(/[^:]+:\/\/([^\.]+\.)?google\.com/i)&&"string"==typeof policy.content_filter.google_domains_list&&(header={name:"X-GoogApps-Allowed-Domains",value:policy.content_filter.google_domains_list},d("[GSuite] X-GoogApps-Allowed-Domains mode enabled, adding to the headers: ",header),details.requestHeaders.push(header)),url.hostname.match(/i\.ytimg\.com$/i)&&details.requestHeaders.push({name:"Cache-Control",value:"no-cache"}),{requestHeaders:details.requestHeaders}},module.exports.HeadersReceived=function(details){if(IsAllowed(details))return{};const u=new URL(details.url),score=Remote.Score(details);if(d("[score]",details.url,"\n  Score ->",score),!0===score.hold){if("xmlhttprequest"===details.type&&(u.hostname.match(/^(([^\.])+\.)?classlink\.com$/)||u.hostname.match(/^(([^\.])+\.)?google\.com$/)))return{};const holdRedirect=function(details,hostname){redirectCount[details.tabId]||(redirectCount[details.tabId]={}),redirectCount[details.tabId][details.url]||(redirectCount[details.tabId][details.url]=0),redirectCount[details.tabId][details.url]+=1;const startStall=Date.now(),duration=10*(redirectCount[details.tabId][details.url]+2);for(;Date.now()-startStall<duration;);return redirectCount[details.tabId][details.url]>20?Remote.Policy().content_filter.bypass_on_failure?void 0:"https://localhost:6543/error?h="+hostname:details.url}(details,u.hostname);if(void 0!==holdRedirect)return{redirectUrl:holdRedirect}}else if(score.redirect&&""!==score.redirect&&"override"!==score.reason){if("xmlhttprequest"===details.type&&u.hostname.match(/^(([^\.])+\.)?googlevideo\.com$/))return{};const rURL=new URL(score.redirect);return"blocked"===score.allow&&(score.type=details.type,d("[score] reporting block ->",score.url),Remote.Report(score)),"main_frame"===details.type||"sub_frame"===details.type||rURL.hostname===u.hostname?(d("[score] redirecting tab ->",details.tabId," to ->",score.redirect),{redirectUrl:score.redirect}):"image"===details.type||u.hostname.match(/ytimg\.com$/i)?{redirectUrl:chrome.extension.getURL("blocked-image-search.png")}:(d("[score] canceling request ->",details.url),{cancel:!0})}return{}},module.exports.IsAllowed=IsAllowed,module.exports.ScanTabs=function(){chrome.tabs.query({currentWindow:!0,active:!0},tabs=>{const tabInfo=tabs[0];if(!tabInfo||void 0===tabInfo.url||""===tabInfo.url)return;const details={url:tabInfo.url,tabId:tabInfo.id,type:"main_frame"},url=new URL(details.url);if(allowedLists(url))return;if(allowedInternal(url.hostname))return;let score=Remote.Score(details);if("cat"!==score.reason&&"blocked"===score.allow)score.type=details.type,Remote.Report(score),chrome.tabs.update(tabInfo.id,{url:score.redirect});else if(IsAllowed(details))return;score&&!score.hold&&(lastTabUrl[tabInfo.id]!==tabInfo.url&&(score.type=details.type,Remote.Report(score),lastTabUrl[tabInfo.id]=tabInfo.url),score.redirect?(d("[tab] redirecting tab ->",tabInfo.id," to ->",score.redirect),chrome.tabs.update(tabInfo.id,{url:score.redirect})):Remote.ReportTime(score))})}},{"./remote":8,debug:1}],6:[function(require,module,exports){const d=require("debug")("flags"),Remote=require("./remote");let terms,flagSettings,reportedTerms={};module.exports.Configure=function(){d("[Configure]");const policy=Remote.Policy();try{terms=[],policy.flags.terms&&policy.flags.terms.length>0&&policy.flags.terms.forEach(term=>{const args={term};let regexTerm=term.replace(/[\]{}?^$().*\\+|[]/g,"\\$&");regexTerm=regexTerm.replace(/\\\*/g,".*"),regexTerm=regexTerm.replace(/\\\?/g,"."),args.regex=new RegExp("\\b"+regexTerm+"\\b","gi"),terms.push(args)});const ret={};policy.flags.settings&&Object.keys(policy.flags.settings).forEach(site=>{let matcher;if(void 0===ret[site]){if(ret[site]=policy.flags.settings[site],ret[site].regex)matcher=ret[site].matcher,delete ret[site].regex;else if(matcher=ret[site].matcher.replace(/[\]{}?^$().*\\+|[]/g,"\\$&").replace(/\\\*/g,".*"),!matcher.match("/")){let prefix=!0;matcher.match(/^\.\*/)&&(matcher="^[^:]+://"+matcher,prefix=!1),matcher.match(/\.\*$/)?(matcher.match("^[^:]+://")||(matcher="^[^:]+://"+matcher),prefix=!1):matcher+="\\/",prefix&&(matcher="^[^:]+://([^\\.]+\\.)*"+matcher)}ret[site].matcher=new RegExp(matcher,"i")}}),flagSettings=ret,d("[Settings] -> ",flagSettings),d("[Terms] -> ",terms)}catch(e){terms=[],flagSettings={},d("[Configure] error -> ",e)}},module.exports.ProcessText=function(data){d("[ProcessText] -> ",data);const flags=[],urlObject=new URL(data.url);void 0===reportedTerms[urlObject.href]&&(reportedTerms[urlObject.href]={}),d("[ProcessText] current -> ",reportedTerms[urlObject.href]),terms.forEach(args=>{const hits=data.text.match(args.regex);null!=hits&&hits.length>0&&void 0===reportedTerms[urlObject.href][args.term]&&(flags.push([args.term,hits.length]),reportedTerms[urlObject.href][args.term]=hits.length,d("[ProcessText] hit -> ",hits))}),function(url,flags){if(!Array.isArray(flags))throw new Error("flags must be an array");if(0===flags.length)return;Remote.ReportFlags({flags,url})}(data.url,flags)},module.exports.GetFlagMode=function(url){let ret=Remote.Policy().content_filter.flag_mode;return Object.keys(flagSettings).some(site=>{const args=flagSettings[site];if(url.match(args.matcher)&&void 0!==args.mode)return ret=args.mode,!0}),ret},module.exports.GetFlagIngored=function(url){let ret=!1;return Object.keys(flagSettings).some(site=>{const args=flagSettings[site];if(url.match(args.matcher)&&void 0!==args.ignore)return ret=args.ignore,!0}),ret}},{"./remote":8,debug:1}],7:[function(require,module,exports){const manifest=chrome.runtime.getManifest();require("debug").enable("*");const d=require("debug")("main"),Filter=require("./filter"),Remote=require("./remote"),Flags=require("./flags");chrome.webRequest.onBeforeRequest.addListener(details=>Filter.BeforeRequest(details),{types:["main_frame","sub_frame","script","image","object","xmlhttprequest","other","websocket"],urls:["<all_urls>"]},["blocking"]),chrome.webRequest.onBeforeSendHeaders.addListener(details=>Filter.BeforeSendHeaders(details),{urls:["<all_urls>"]},["blocking","requestHeaders"]),chrome.webRequest.onHeadersReceived.addListener(details=>Filter.HeadersReceived(details),{types:["main_frame","sub_frame","script","image","object","xmlhttprequest","other","websocket"],urls:["<all_urls>"]},["blocking"]),setInterval((function(){Filter.ScanTabs()}),1e3),chrome.runtime.onMessage.addListener((message,sender,sendResponse)=>{let tabId;switch(d("[in_page] message ->",message),sender.tab&&sender.tab.id&&(tabId=sender.tab.id),message.action){case"eval":Flags.GetFlagIngored(sender.url)||"page"===Flags.GetFlagMode(sender.url)||Flags.ProcessText({text:message.text,url:sender.url,type:"intent"});break;case"flags":Remote.FilterOpen()&&Flags.ProcessText({text:message.text,url:sender.url,type:"scan"});break;case"settings":sendResponse(Remote.GetSettings(message.href))}}),console.debug("Lightspeed",manifest.description,"version",manifest.version,"Loaded.")},{"./filter":5,"./flags":6,"./remote":8,debug:1}],8:[function(require,module,exports){const d=require("debug")("remote"),Flags=(require("./filter"),require("./flags"));let wsFilterCheckInt,wsFilterCheckInInt,wsFilterPolicyInt,wsFilter,cache={},policy={},overrideUntil=0,lockoutUntil=0,wsFilterOpen=!1;function onFilterMessage(m){try{const jData=JSON.parse(m.data);switch(d(`[onMessage] '${jData.action}' from agent -> ${JSON.stringify(jData)}`),jData.action){case"lockout":d("[onLockoutMessage] lockout -> ",data=jData),lockoutUntil=data.until;break;case"override":!function(data){d("[onOverrideMessage] overriding -> ",data),overrideUntil=Date.now()+6e4*Policy().content_filter.override_timeout,purgeCacheItems()}(jData);break;case"policy":!function(data){policy=data.policy,Flags.Configure(),purgeCacheItems()}(jData);break;case"score":!function(data){data.at=Date.now(),data.hold=!1,d("[onScoreMessage] caching -> ",data),cache[data.url]=data}(jData);break;default:d("[onMessage] unknown message")}}catch(err){d("[onMessage] error ->",err)}var data}function onFilterOpen(){d("[onOpen] filter agent connection open"),wsFilterOpen=!0,getPolicy()}function onFilterError(){wsFilter=void 0}function wsFilterConnect(){wsFilter&&wsFilter.readyState!==WebSocket.CLOSED&&wsFilter.readyState!==WebSocket.CLOSING||(wsFilter=void 0,wsFilter=new WebSocket("wss://localhost:6543/websocket"),wsFilter.onmessage=onFilterMessage,wsFilter.onopen=onFilterOpen,wsFilter.onerror=onFilterError),wsFilterCheckInt&&clearTimeout(wsFilterCheckInt),wsFilterCheckInt=setTimeout(wsFilterConnect,5e3)}function sendFilterMessage(data){if(wsFilter&&wsFilter.readyState===WebSocket.OPEN)try{d("[sendFilterMessage] to filter agent -> ",data),wsFilter.send(JSON.stringify(data))}catch(err){console.log(err)}else wsFilterConnect()}function Policy(){return policy||(policy={}),policy.allowed||(policy.allowed={protocols:[],urls:[],hosts:[]}),policy.content_filter||(policy.content_filter={block_url:"https://localhost:6543/block",flag_mode:"page",google_filter_domains:!1,override_timeout:5,overrides:[],read_only:[]}),policy.flags||(policy.flags={terms:[],seettings:[]}),policy.matchers||(policy.matchers={search:[],social:[],youtube:[],yt_restricted:[]}),policy.youtube||(policy.youtube={age_restriction:!1,hide_comments:!1,hide_sidebar:!1,hide_thumbnails:!1,prevent_channel_autoplay:!1,restricted_mode:!1}),policy}function getPolicy(){sendFilterMessage({action:"policy"})}function IsYoutube(hostname){const policy=Policy();if(!policy.matchers.youtube)return!1;const matchers=policy.matchers.youtube,l=matchers.length;for(let i=0;i<l;i++)if(hostname.match(matchers[i]))return!0;return!1}function Report(data){data.at_epoch_ms=Date.now().toString();sendFilterMessage({action:"report",data})}function purgeCacheItems(){cache={}}setTimeout((function wsFilterPolicy(){wsFilterOpen&&getPolicy(),wsFilterPolicyInt&&clearTimeout(wsFilterPolicyInt),wsFilterPolicyInt=setTimeout(wsFilterPolicy,3e5)}),3e5),setTimeout((function wsFilterCheckIn(){sendFilterMessage({action:"heartbeat"}),wsFilterCheckInInt&&clearTimeout(wsFilterCheckInInt),wsFilterCheckInInt=setTimeout(wsFilterCheckIn,5e3)}),5e3),wsFilterConnect(),module.exports.FilterOpen=function(){return wsFilterOpen},module.exports.GetSettings=function(url){const resp={action:"settings"};if(!wsFilterOpen)return resp;const policy=Policy();if(resp.readOnly=!1,"string"==typeof url){const a=new URL(url),readOnly=policy.content_filter.read_only;policy.matchers.social.some(matcher=>{const r=new RegExp(matcher.hostname);a.hostname.match(r)&&readOnly.includes(matcher.catId)&&(resp.readOnly=!0)})}return Flags.GetFlagIngored(url)||"intent"===Flags.GetFlagMode(url)||(resp.flag_scan=!0),resp.ytSettings={hide_comments:policy.youtube.hide_comments,hide_sidebar:policy.youtube.hide_sidebar,disable_chan_autoplay:policy.youtube.prevent_channel_autoplay,block_thumbnails:policy.youtube.hide_thumbnails},resp},module.exports.IsYoutube=IsYoutube,module.exports.Overridable=function(details){if(new URL(details.url),overrideUntil>Date.now()){const c=cache[details.url];if(c&&Policy().content_filter.overrides.includes(c.category_id))return d("[overridable] -> ",c),"main_frame"===details.type&&"blocked"===c.allow&&"cat"===c.reason&&(c.allow="allowed",c.reason="override",Report(c)),!0}return!1},module.exports.Policy=Policy,module.exports.Report=Report,module.exports.ReportFlags=function(data){data.at_epoch_ms=Date.now().toString(),sendFilterMessage({action:"reportFlags",data})},module.exports.ReportTime=function(data){data.at_epoch_ms=Date.now().toString()},module.exports.Score=function(details){let url;const n=Date.now(),u=new URL(details.url),h=u.host;url=IsYoutube(h)||function(hostname){const policy=Policy();if(!policy.matchers.search)return!1;const matchers=policy.matchers.search,l=matchers.length;for(let i=0;i<l;i++)if(hostname.match(matchers[i].hostname)){if(notModMatchers=matchers[i].notModifyHost,notModMatchers){const ll=notModMatchers.length;for(let ii=0;ii<ll;ii++)if(hostname.match(notModMatchers[ii]))return!1}return!0}return!1}(h)?details.url:u.href.replace(u.search,"");let c=cache[url];return c?c&&!c.hold&&(d("[score] score complete -> ",c),lockoutUntil>n?(c.allow="blocked",c.reason="lockout",c.redirect=`${policy.content_filter.block_url}?id=lockout&h=${h}`):"lockout"===c.reason&&(c.hold=!0,delete cache[url])):(c={action:"score",at:n,host:h,hold:!0,url},cache[url]=c,d("[score] host request -> ",c),sendFilterMessage(c)),c}},{"./filter":5,"./flags":6,debug:1}]},{},[7]);